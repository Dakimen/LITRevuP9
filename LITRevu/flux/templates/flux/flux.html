{%extends 'flux/base.html'%}
{% load flux_extras %}
{%block content%}

<div class="flux">
    <div class="create_buttons">
        <a href="{% url 'create-ticket' %}">Demander une critique</a>
        <a href="{% url 'create-review' %}">Créer une critique</a>
    </div>
    {% for instance in tickets_and_reviews %}
    {% if 'Aucun' in tickets_and_reviews %}
        <p>Aucun résultat trouvé. Créez un ticket ou allez dans les abonnements pour trouver quelqu'un à suivre !</p>
    {% else %}
    {% if instance|model_type == "Ticket" %}
    <div class="ticket">
        <p>{{instance.author}} a demandé une critique</p>
        <p class="time">{{instance.time_created}}</p>
        <p><strong>{{instance.title}}</strong></p>
        <p>{{instance.description}}</p>
        {% if instance.image %}
        <img src="{{instance.image.url}}" alt="ticket image" title="ticket image">
        {%endif%}
        {% review_exists instance user as review_exists_flag %}
        {% if not review_exists_flag %}
        <div class="create_review">
            <a href="{% url 'create-review-response' instance.id %}">Créer une critique</a>
        </div>
        {% endif %}
    </div>
    {% elif instance|model_type == "Review" %}
    <div class="review">
        <p>{{instance.author}} a publié une critique</p>
        <p class="time">{{instance.time_created}}</p>
        <p><strong>{{instance.headline}} - {{instance.rating|review_rating}}</strong></p>
        <p>{{instance.body}}</p>
        <div class="inner_ticket">
            <p>Ticket - {{instance.ticket.author}} a demandé une critique</p>
            <p>{{instance.ticket.title}}</p>
            {% if instance.ticket.image %}
                <img src="{{instance.ticket.image.url}}" alt="ticket image" title="ticket image">
            {%endif%}
        </div>
    </div>
    {%endif%}
    {% endif %}
    {%endfor%}
</div>
{%endblock%}